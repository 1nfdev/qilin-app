#!/usr/bin/env node

var fs      = require( "fs" );
var path    = require( "path" );

var browser = require( "browserify" )( {
    entries : [ path.resolve( __dirname, "../client/index.js" ) ],
    paths   : [ path.resolve( __dirname, "../node_modules" ) ],

    plugin          : [ require( "watchify" ) ],
    cache           : {},
    packageCache    : {}
} );

browser.transform( require( "babelify" ) );
browser.transform( require( "uglifyify" ), { global : true } );

browser.on( "update", () => {
    console.log( "Rebuilding" );
    build();
} );

console.log( "Start" );
build();

function build() {
    browser
        .bundle()
        .on( "error", error => console.log( error ) )
        .on( "end", () => console.log( "Done" ) )
        .pipe( fs.createWriteStream( path.resolve( __dirname, "../client/compiled.js" ) ) );
}
